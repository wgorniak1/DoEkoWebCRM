function onConfirmationChange(){var i=$(this).prop("checked"),r=$("#BPPersonListTable").DataTable().row(this.closest('tr[role="row"]')).data(),n=new FormData,t;n.append("id",r.businessPartnerId);n.append("allowed",i);t=$.ajax({url:"DataProcessingAllowed",type:"POST",cache:!1,contentType:!1,processData:!1,data:n});t.done(function(){WgTools.alert("Zapisano zmiany",!0,"S");r.dataProcessingConfirmation=i});t.fail(function(n,t,i){WgTools.alert(i,!0,"E")})}function onPersonDelete(n){$("body").one("click","button.person-delete-submit",{row:n},onPersonDeleteSubmit);$("#PersonDeleteModal").modal("show")}function onPersonEdit(){}function onPersonDeleteCancel(){}function onPersonDeleteSubmit(n){var i=$('input[name="__RequestVerificationToken"]').val(),t=$.ajax({type:"POST",url:"Delete",data:{id:n.data.row.data().businessPartnerId,__RequestVerificationToken:i}});t.done(function(){n.data.row.remove().draw("full-hold");WgTools.alert("Dane właściciela zostały usunięte.",!0,"S")});t.fail(function(n){$.each(n.responseJSON,function(n,t){t.length>0&&WgTools.alert(t,!1,"E")})})}function onPersonEditCancel(){}function onPersonEditSubmit(){}$(document).ready(function(){var n=!1,t=$("#BPPersonListTable").DataTable({ajax:{url:"List",dataSrc:"data",rowId:"businessPartnerId"},columns:[{responsivePriority:1,data:"fullName",name:"fullName",title:"Nazwisko i Imię",type:"html",render:function(n,t){switch(t){case"display":return n.length>30?n.replace(" ","<br/>"):n;case"filter":return n;case"sort":return n}}},{responsivePriority:8,data:"pesel",name:"pesel",title:"Pesel"},{responsivePriority:9,data:"idNumber",name:"idNumber",title:"Nr dowodu os."},{responsivePriority:10,data:"taxId",name:"taxId",title:"NIP"},{responsivePriority:11,data:"birthDate",name:"birthDate",title:"Data urodz.",type:"date",render:function(n,t){var i=new Date(Date.parse(n));switch(t){case"display":return i>new Date("1900/01/01")?i.toLocaleDateString():"";case"filter":return i;case"sort":return i}}},{responsivePriority:6,data:"email",name:"email",title:"E-mail",type:"string",render:function(n,t){switch(t){case"display":return n?'<a href="mailto:'+n+'" class="">'+n+"<\/a>":"";case"filter":return n;case"sort":return n}}},{responsivePriority:7,data:"phoneNumber",name:"phoneNumber",title:"Telefon",type:"num",render:function(n,t){switch(t){case"display":return n?'<a href="tel:'+n.replace(/\s+/g,"")+'">'+n+"<\/a>":"";case"filter":return n.replace(/\s+/g,"");case"sort":return n.replace(/\s+/g,"")}}},{responsivePriority:4,data:"address",name:"address",title:"Adres",type:"html",render:function(n,t){switch(t){case"display":return n.firstLine+"<br/>"+n.secondLine;case"filter":return n.secondLine+","+n.firstLine;case"sort":return n.secondLine+","+n.firstLine}}},{responsivePriority:3,data:"dataProcessingConfirmation",name:"dataProcessingConfirmation",title:"Zgoda na przetw. danych",type:"string",render:function(t,i,r){switch(i){case"display":if(n){var u='<input type="checkbox" id="dataProcessingConfirmation['+r.businessPartnerId+']" name="dataProcessingConfirmation" class="form-control checkbox person-confirmationchange" data-onstyle="success" data-size="small" data-toggle="toggle" data-on="Tak" data-off="Nie" value="'+t+'"';return u+(t?"checked />":"/>")}return t?"Tak":"Nie";case"filter":return t?"Tak":"Nie";case"sort":return t?"Tak":"Nie"}}},{responsivePriority:12,data:"investments",name:"investmentsCount",title:"Liczba inwestycji",type:"num",render:function(n){return n.length}},{responsivePriority:5,data:"investments",name:"investments",title:"Inwestycje",type:"html",render:function(n,t){var i="";switch(t){case"display":return n.forEach(function(n){i+='<tr><td><a href="/Investments/Details/'+n.investmentId+'" target="_blank">'+n.address.firstLine+"<br/>"+n.address.secondLine+"<\/a ><\/td ><\/tr > "}),"<table>"+i+"<\/table>";case"filter":return n.forEach(function(n){i+=n.address.secondLine+","+n.address.firstLine+","}),i;case"sort":return n.forEach(function(n){i+=n.address.secondLine+","+n.address.firstLine+","}),i}}},{responsivePriority:2,data:null,name:"actions",title:"Akcje",orderable:!1,searchable:!1,type:"html",width:"100px",autoWidth:!1,visible:!0,render:function(n){var t="";return t='<div class="pull-right">',t+='<button title="Edytuj dane" class="btn btn-default btn-sm person-edit" type="button"><span class="glyphicon glyphicon-pencil"><\/span><\/button>',n.investments.length===0&&(t+='<button class="btn btn-default btn-sm person-delete" type="button"><span class="glyphicon glyphicon-trash"><\/span><\/button>'),t+"<\/div>"}}],stateSave:!0,pagingType:"full",language:WgLanguage,lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"Wszystkie"]],order:[[0,"asc"]],processing:!0,dom:"<'row'<'col-sm-6'B><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-4'l><'col-sm-4'i><'col-sm-4'p>>",buttons:[{extend:"copyHtml5",text:'<span class="glyphicon glyphicon-copy"><\/span>',className:"btn text-primary",copySuccess:{1:"Skopiowano 1 rekord do schowka",_:"Skopiowano %d rekordów do schowka"},copyTitle:"Kopiowanie do schowka",copyKeys:"Naciśnij <i>ctrl<\/i> lub <i>⌘<\/i> + <i>C<\/i> aby skopiować tabelę<br>do schowka.<br><br>aby anulować, kliknij ten komunikat lub naciśnij ESC."},{extend:"csvHtml5",text:'<span class="glyphicon glyphicon-download-alt" title="Export do CSV"><\/span>',className:"btn text-primary",fieldSeparator:";",charset:"UTF-8"},{extend:"colvis",text:'<span class="glyphicon glyphicon-th-list" title="Pokaż / Ukryj kolumny"><\/span>',className:"btn text-primary"},{text:'<span class="text-primary glyphicon glyphicon-refresh" title="Odśwież zawartość"><\/span>',className:"btn",action:function(n,t){t.ajax.reload();t.rows().cells().invalidate().render()}},{text:'<span class="text-primary glyphicon glyphicon-check" title="Edytuj zgody..."><\/span>',className:"btn",action:function(t,i){n=!n;i.column("dataProcessingConfirmation").cells().invalidate().render();i.rows().every(function(n){i.row(n).child.isShown()&&($(i.cell(n,0).node()).click(),$(i.cell(n,0).node()).click())});$("input[name=dataProcessingConfirmation]").bootstrapToggle(n?"":"destroy")}}],select:!1,colReorder:{fixedColumnsRight:1},fixedHeader:{headerOffset:$("#NavBarMain").outerHeight()},deferRenderer:!0,drawCallback:function(){$("input[name=dataProcessingConfirmation]").bootstrapToggle(n?"":"destroy")}});t.on("responsive-display",function(){$("input[name=dataProcessingConfirmation]").bootstrapToggle(n?"":"destroy")})});$("body").on("change","input.person-confirmationchange",onConfirmationChange);$("body").on("click","button.person-edit",function(){$(this).attr("disabled","disabled");onPersonEdit($("#BPPersonListTable").DataTable().row($(this).parents("tr")));$(this).removeAttr("disabled")});$("body").on("click","button.person-delete",function(){$(this).attr("disabled","disabled");onPersonDelete($("#BPPersonListTable").DataTable().row($(this).parents("tr")));$(this).removeAttr("disabled")});