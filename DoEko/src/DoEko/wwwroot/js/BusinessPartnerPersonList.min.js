function onConfirmationChange(){var i=$(this).prop("checked"),u=$(this).closest("tr").index(),r=$("#BPPersonListTable").dataTable().api().row(u).data(),n=new FormData,t;n.append("id",r.businessPartnerId);n.append("allowed",i);t=$.ajax({url:"DataProcessingAllowed",type:"POST",cache:!1,contentType:!1,processData:!1,data:n});t.done(function(){WgTools.alert("Zapisano zmiany",!0,"S");r.dataProcessingConfirmation=i});t.error(function(n,t,i){WgTools.alert(i,!0,"E")})}$(document).ready(function(){var n=!1,t=$("#BPPersonListTable").DataTable({ajax:{url:"List",dataSrc:"data",rowId:"businessPartnerId"},columns:[{data:"fullName",name:"fullName",title:"Nazwisko i Imię"},{data:"pesel",name:"pesel",title:"Pesel"},{data:"idNumber",name:"idNumber",title:"Nr dowodu os."},{data:"taxId",name:"taxId",title:"NIP"},{data:"birthDate",name:"birthDate",title:"Data urodz.",type:"date",render:function(n,t){var i=new Date(Date.parse(n));switch(t){case"display":return i>new Date("1900/01/01")?i.toLocaleDateString():"";case"filter":return i;case"sort":return i}}},{data:"email",name:"email",title:"E-mail",type:"string",render:function(n,t){switch(t){case"display":return n?'<a href="mailto:'+n+'" class="">'+n+"<\/a>":"";case"filter":return n;case"sort":return n}}},{data:"phoneNumber",name:"phoneNumber",title:"Telefon",type:"html-num",render:function(n){return n?'<a href="tel:'+n.replace(/\s+/g,"")+'">'+n+"<\/a>":""}},{data:"address",data:"address",title:"Adres",type:"string",render:function(n,t){switch(t){case"display":return n.firstLine+"<br/>"+n.secondLine;case"filter":return n.singleLine;case"sort":return n.singleLine}}},{data:"dataProcessingConfirmation",name:"dataProcessingConfirmation",title:"Zgoda na przetw. danych",type:"string",render:function(t,i,r){switch(i){case"display":if(n){var u='<input type="checkbox" id="dataProcessingConfirmation['+r.businessPartnerId+']" name="dataProcessingConfirmation" class="form-control checkbox confirmationchange" data-toggle="toggle" data-on="Tak" data-off="Nie" value="'+t+'"';return u+(t?"checked />":"/>")}return t?"Tak":"Nie";case"filter":return t?"Tak":"Nie";case"sort":return t?"Tak":"Nie"}}},{data:"investments",name:"investmentsCount",title:"Liczba inwestycji",type:"num",render:function(n){return n.length}},{data:"investments",name:"investments",title:"Inwestycje",type:"html",render:function(n,t){var i="";switch(t){case"display":return n.forEach(function(n){i+='<tr><td><a href="/Investments/Details/'+n.investmentId+'" target="_blank">'+n.address.singleLine+"<\/a ><\/td ><\/tr > "}),"<table>"+i+"<\/table>";case"filter":return n.forEach(function(n){i+=n.address.singleLine+";"}),i;case"sort":return n.forEach(function(n){i+=n.address.singleLine+";"}),bdt}}}],stateSave:!0,language:{url:"/js/datatables-language-pl.json"},lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"Wszystkie"]],order:[[0,"asc"]],processing:!0,dom:"<'row'<'col-sm-6'B><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-4'l><'col-sm-4'i><'col-sm-4'p>>",buttons:[{extend:"copyHtml5",text:'<span class="glyphicon glyphicon-copy"><\/span>',className:"btn-sm text-primary"},{extend:"csvHtml5",text:'<span class="glyphicon glyphicon-download-alt" title="Export do CSV"><\/span>',className:"btn-sm text-primary"},{extend:"colvis",text:'<span class="glyphicon glyphicon-th-list" title="Pokaż / Ukryj kolumny"><\/span>',className:"btn-sm text-primary"},{text:'<span class="text-primary glyphicon glyphicon-refresh" title="Odśwież zawartość"><\/span>',className:"btn-sm",action:function(n,t){t.ajax.reload();t.rows().invalidate().render()}},{text:'<span class="text-primary glyphicon glyphicon-pencil" title="Edytuj zgody..."><\/span>',className:"btn-sm",action:function(t,i){n=!n;i.column("dataProcessingConfirmation").cells().invalidate().render();i.rows().every(function(n){i.row(n).child.isShown()&&($(i.cell(n,0).node()).click(),$(i.cell(n,0).node()).click())});$("input[name=dataProcessingConfirmation]").bootstrapToggle(n?"":"destroy")}},],select:!0,colReorder:!0,fixedHeader:{headerOffset:$("#NavBarMain").outerHeight()},drawCallback:function(){$("div#BPPersonListTable_processing").addClass("wg-loader");var t=$("div#BPPersonListTable_filter");$("*",t).addClass("small");t=$("div#BPPersonListTable_length");$("label",t).addClass("small");$("select",t).addClass("small");t=$("div#BPPersonListTable_info");t.addClass("small");$("*",t).addClass("small");t=$("div#BPPersonListTable_paginate");$("ul > li > a",t).addClass("small").attr("style","padding: 5px 10px;");$("input[name=dataProcessingConfirmation]").bootstrapToggle(n?"":"destroy")}});t.on("responsive-display",function(){$("input[name=dataProcessingConfirmation]").bootstrapToggle(n?"":"destroy")})});$("body").on("change","input.confirmationchange",onConfirmationChange);