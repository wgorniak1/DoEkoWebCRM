function onUserCreate(){var n=$.ajax({type:"GET",url:"Create",dataType:"html"});n.done(function(n){$("#UserDeleteModal").after(n);var i=$("#MaintainUserModal"),t=$("form",i);t.removeData("validator");t.removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(t);t.data("validator").settings.ignore=".data-val-ignore, :hidden, :disabled";i.modal("show");$("body").on("click","button.user-create-cancel",onUserCreateCancel);$("body").on("click","button.user-create-submit",onUserCreateSubmit)});n.fail(function(n,t,i){WgTools.alert(i,!1,"E")})}function onUserEdit(n){var t=$.ajax({type:"GET",url:"Edit",data:{userId:n},dataType:"html"});t.done(function(n){$("#UserDeleteModal").after(n);var i=$("#MaintainUserModal"),t=$("form",i);t.removeData("validator");t.removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(t);t.data("validator").settings.ignore=".data-val-ignore, :hidden, :disabled";i.modal("show");t.on("click","button.user-edit-cancel",onUserEditCancel);t.on("click","button.user-edit-submit",onUserEditSubmit)});t.fail(function(n,t,i){WgTools.alert(i,!1,"E")});$(this).bind()}function onUserDelete(n){$("body").one("click","button.user-delete-submit",{userId:n},onUserDeleteSubmit);$("#UserDeleteModal").modal("show")}function onUserLock(n){var i=$('input[name="__RequestVerificationToken"]').val(),t=$.ajax({type:"POST",url:"Lock",data:{Id:n,__RequestVerificationToken:i}});t.done(function(){$("#UserListTable").DataTable().ajax.reload();WgTools.alert("Konto użytkownika zostało zablokowane.",!0,"S")});t.fail(function(n){$.each(n.responseJSON,function(n,t){t.length>0&&WgTools.alert(t,!1,"E")})})}function onUserUnlock(n){var i=$('input[name="__RequestVerificationToken"]').val(),t=$.ajax({type:"POST",url:"UnLock",data:{Id:n,__RequestVerificationToken:i}});t.done(function(){$("#UserListTable").DataTable().ajax.reload();WgTools.alert("Konto użytkownika zostało odblokowane.",!0,"S")});t.fail(function(n){$.each(n.responseJSON,function(n,t){t.length>0&&WgTools.alert(t,!1,"E")})})}function onUserEditCancel(){DestroyModal("#MaintainUserModal")}function onUserEditSubmit(){var n=$("form",$("#MaintainUserModal")),r=$(":input:not([type=hidden],[hidden],[readonly])",n),t=$("button.user-edit-submit"),f=t.text(),u,i;n.validate({lang:"pl"});n.valid()&&(u=n.serialize(),r.each(function(){$(this).attr("disabled","disabled")}),t.text("Trwa zapisywanie..."),i=$.ajax({type:n.attr("data-ajax-method")||"POST",url:n.attr("action"),data:u}),i.fail(function(n){var i=$("div.validation-summary-valid.text-danger > ul");i.empty();$.each(n.responseJSON,function(n,t){for(var r=0;r<t.length;r++)i.append("<li>"+t[r]+"<\/li>")});r.each(function(){$(this).removeAttr("disabled")});t.text(f)}),i.done(function(){DestroyModal("#MaintainUserModal");$("#UserListTable").DataTable().ajax.reload();WgTools.alert("Pomyślnie zapisano dane konta użytkownika",!0,"S")}))}function onUserCreateCancel(){DestroyModal("#MaintainUserModal")}function onUserCreateSubmit(){var n=$("form",$("#MaintainUserModal")),r=$(":input:not([type=hidden],[hidden],[readonly])",n),t=$("button.user-create-submit"),f=t.text(),u,i;n.validate({lang:"pl"});n.valid()&&(u=n.serialize(),r.each(function(){$(this).attr("disabled","disabled")}),t.text("Trwa zapisywanie..."),i=$.ajax({type:n.attr("data-ajax-method")||"POST",url:n.attr("action"),data:u}),i.fail(function(n){var i=$("div.validation-summary-valid.text-danger > ul");i.empty();$.each(n.responseJSON,function(n,t){for(var r=0;r<t.length;r++)i.append("<li>"+t[r]+"<\/li>")});r.each(function(){$(this).removeAttr("disabled")});t.text(f)}),i.done(function(){DestroyModal("#MaintainUserModal");$("#UserListTable").DataTable().ajax.reload();WgTools.alert("Pomyślnie utworzono nowe konto użytkownika",!0,"S")}))}function onUserDeleteCancel(){}function onUserDeleteSubmit(n){var i=$('input[name="__RequestVerificationToken"]').val(),t=$.ajax({type:"POST",url:"Delete",data:{Id:n.data.userId,__RequestVerificationToken:i}});t.done(function(){$("#UserListTable").DataTable().ajax.reload();WgTools.alert("Konto użytkownika zostało usunięte.",!0,"S")});t.fail(function(n){$.each(n.responseJSON,function(n,t){t.length>0&&WgTools.alert(t,!1,"E")})})}function DestroyModal(n){var t=$(n);t.one("hidden.bs.modal",function(){t.remove()});t.modal("hide")}$(document).ready(function(){var n=$("#UserListTable").DataTable({ajax:{url:"List",dataSrc:"data"},rowId:"id",columns:[{data:"null",name:"fullName",title:"Nazwisko i Imię",render:function(n,t,i){return i.lastName+" "+i.firstName},searchable:!0,orderable:!0},{data:"userName",name:"userName",title:"Login",searchable:!0,orderable:!0},{data:"email",name:"email",title:"E-mail",type:"html",render:function(n){return'<a href="mailto:'+n+'" class="">'+n+"<\/a>"},searchable:!0,orderable:!0,visible:!1},{data:"emailConfirmed",name:"emailConfirmed",title:"e-mail zweryfikowano",render:function(n){return n===!0?'<span class="glyphicon glyphicon-ok"><\/span>':'<span class="glyphicon glyphicon-remove"><\/span>'},searchable:!1,orderable:!0,visible:!1},{data:"phoneNumber",name:"phoneNumber",title:"Telefon",searchable:!0,visible:!1},{data:"_roles",name:"role",title:"Rola",render:function(n){var i=n,t="";return i.forEach(function(n){t+=n.name}),t},searchable:!1,orderable:!0,visible:!0},{data:"accessFailedCount",name:"accessFailedCount",title:"Nieudanych prób logowania",searchable:!0,orderable:!0,visible:!1},{data:"lockoutEnd",name:"lockoutEnd",title:"Zablokowane do",searchable:!1,orderable:!0,visible:!1},{data:null,name:"actions",type:"html",render:function(n,t,i){var u=new Date,f=i.lockoutEnd===""?u:new Date(Date.parse(i.lockoutEnd)),r="";return r='<div class="pull-right">',r+='<button title="Edytuj dane" class="btn btn-default btn-sm user-edit" type="button"><span class="glyphicon glyphicon-pencil"><\/span><\/button>',r+=f<=u&&i.lockoutEnabled===!0?'<button title="Zablokuj konto" class="btn btn-default btn-sm user-lock" type="button"><i class="fa fa-lock"><\/i><\/button>':f<=u&&i.lockoutEnabled===!1?'<button title="Zablokuj konto" class="btn btn-default btn-sm disabled" type="button" disabled><i class="fa fa-lock"><\/i><\/button>':'<button title="Odblokuj konto" class="btn btn-default btn-sm user-unlock" type="button"><i class="fa fa-unlock"><\/i><\/button>',r+='<button class="btn btn-default btn-sm user-delete" type="button"><span class="glyphicon glyphicon-trash"><\/span><\/button>',r+"<\/div>"},width:"100px",autoWidth:!1,searchable:!1,orderable:!1,visible:!0}],stateSave:!0,language:WgLanguage,lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"Wszystkie"]],order:[[0,"asc"]],processing:!0,dom:"<'row'<'col-sm-6'B><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-4'l><'col-sm-4'i><'col-sm-4'p>>",buttons:[{extend:"copyHtml5",text:'<span class="text-primary glyphicon glyphicon-copy"><\/span>',className:"btn-sm text-primary"},{extend:"csvHtml5",text:'<span class="text-primary glyphicon glyphicon-download-alt" title="Export do CSV"><\/span>',className:"btn-sm text-primary"},{extend:"colvis",text:'<span class="text-primary glyphicon glyphicon-th-list" title="Pokaż / Ukryj kolumny"><\/span>',className:"btn-sm"},{text:'<span class="text-primary glyphicon glyphicon-refresh" title="Odśwież zawartość"><\/span>',className:"btn-sm",action:function(n,t){t.ajax.reload();t.columns.adjust().draw()}},{text:'<span class="glyphicon glyphicon-plus" title="Dodaj nowego użytkownika"><\/span>',className:"btn-sm btn-primary",action:function(n,t){$(this).attr("disabled","disabled");onUserCreate(t);$(this).removeAttr("disabled")}}],select:!1,colReorder:{fixedColumnsRight:1},responsive:!0,columnDefs:[{responsivePriority:1,targets:0},{responsivePriority:400,targets:1},{responsivePriority:500,targets:2},{responsivePriority:600,targets:3},{responsivePriority:700,targets:4},{responsivePriority:800,targets:5},{responsivePriority:900,targets:6},{responsivePriority:900,targets:7},{responsivePriority:1,targets:8}],fixedHeader:{headerOffset:$("#NavBarMain").outerHeight()},drawCallback:function(){var n=$("div#UserListTable_filter");$("*",n).addClass("small");n=$("div#UserListTable_length");$("label",n).addClass("small");$("select",n).addClass("small");n=$("div#UserListTable_info");n.addClass("small");$("*",n).addClass("small");n=$("div#UserListTable_paginate");$("ul > li > a",n).addClass("small").attr("style","padding: 5px 10px;")}})});$("body").on("click","button.user-edit",function(){$(this).attr("disabled","disabled");onUserEdit($("#UserListTable").DataTable().row($(this).parents("tr")).id());$(this).removeAttr("disabled")});$("body").on("click","button.user-lock",function(){$(this).attr("disabled","disabled");onUserLock($("#UserListTable").DataTable().row($(this).parents("tr")).id());$(this).removeAttr("disabled")});$("body").on("click","button.user-unlock",function(){$(this).attr("disabled","disabled");onUserUnlock($("#UserListTable").DataTable().row($(this).parents("tr")).id());$(this).removeAttr("disabled")});$("body").on("click","button.user-delete",function(){$(this).attr("disabled","disabled");onUserDelete($("#UserListTable").DataTable().row($(this).parents("tr")).id());$(this).removeAttr("disabled")});