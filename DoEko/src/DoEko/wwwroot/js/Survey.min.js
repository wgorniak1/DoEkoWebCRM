function onCHInsTypeChange(){var n=$(".insulationtype").val();n==="3"?$(".insulationtype-other").show():$(".insulationtype-other").hide()}function onCHTypeChange(){var n=$(".centralheating-type").val();n==="1"?($(".centralheating-other").hide(),$(".centralheating-fuel").hide()):n==="9"?($(".centralheating-other").show(),$(".centralheating-fuel").show()):($(".centralheating-other").hide(),$(".centralheating-fuel").show())}function ajaxGetSectionNo(){var n=$.ajax({type:"GET",url:"/Surveys/MaintainStepAjax",data:{stepNo:stepNo,surveyId:$("#MaintainedSurveyId").val()},dataType:"html"});n.done(function(n,t){onAjaxGetSuccess(n,t)});n.fail(function(n,t,i){onAjaxGetFailure(n,t,i)})}function onNavigationBarClick(n){stepNo=$(this).attr("data-step-number");var t=n.data.save;t?ajaxPostCurrentSection(onAjaxPostError,ajaxGetSectionNo):($("#stepSave").addClass("hidden"),ajaxGetSectionNo())}function onWallSizeChange(){var n=$("#Dynamic form"),t=parseFloat($("#Width",n).val()),i=parseFloat($("#Height",n).val()),r=t*i;$("#UsableArea").val(r.toFixed(2))}function onBoilerRoomSizeChange(){var n=$("#Dynamic form"),t=parseFloat($("#Width",n).val()),i=parseFloat($("#Height",n).val()),r=parseFloat($("#Length",n).val()),u=t*i*r;$("#Volume").val(u.toFixed(2))}function plndInstallChanged(){var n=$(this).val();n===1?$(".plannedinstallationpurpose").hide():$(".plannedinstallationpurpose").show()}function SectionPostFailure(n,t,i){WgTools.alert(i,!0,"E")}function SectionPostSuccess(){WgTools.alert("Pomyślnie zapisano dane sekcji.",!0,"S")}function onAjaxGetSuccess(n){var t,i;$("#Dynamic").html(n);t=$("#Dynamic form");t.removeData("validator");t.removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(t);t.data("validator").settings.ignore=".data-val-ignore, :hidden, :disabled";i=$("#Dynamic form").attr("id");i==="InvestmentGeneralInfo"?($("#stepPrev").attr("disabled","disabled"),$("#stepPrevSave").attr("disabled","disabled")):($("#stepPrev").removeAttr("disabled"),$("#stepPrevSave").removeAttr("disabled"));i==="SurveyPhoto"?($("#stepNext").attr("disabled","disabled"),$("#stepNextSave").attr("disabled","disabled"),$("#stepLast").removeClass("hidden"),$("#stepLastSave").removeClass("hidden")):($("#stepNext").removeAttr("disabled"),$("#stepNextSave").removeAttr("disabled"),$("#stepLast").addClass("hidden"),$("#stepLastSave").addClass("hidden"))}function onAjaxGetFailure(n,t,i){WgTools.alert(i,!0,"E")}function ajaxGetPrevSection(){var n=$.ajax({type:"GET",url:"/Surveys/MaintainPreviousStepAjax",data:{currentStep:$("#Dynamic form").attr("id"),surveyId:$("#MaintainedSurveyId").val()},dataType:"html"});n.done(function(n,t){onAjaxGetSuccess(n,t)});n.fail(function(n,t,i){onAjaxGetFailure(n,t,i)})}function ajaxGetNextSection(){var n=$.ajax({type:"GET",url:"/Surveys/MaintainNextStepAjax",data:{currentStep:$("#Dynamic form").attr("id"),surveyId:$("#MaintainedSurveyId").val()},dataType:"html"});n.done(function(n,t){onAjaxGetSuccess(n,t)});n.fail(function(n,t,i){onAjaxGetFailure(n,t,i)})}function onAjaxPostError(n){var t=Object.keys(n.responseJSON),u=t.map(function(t){return n.responseJSON[t]}),i=0,r=$("form",$("#Dynamic"));t.forEach(function(n){var e=$('input[name="'+n+'"], select[name="'+n+'"]',r),f,t,o;e.removeClass("valid");e.addClass("input-validation-error");e.attr("aria-invalid",!0);f=$('span[data-valmsg-for="'+n+'"]',r);t=document.createElement("span");t.setAttribute("id",n.replace(".","_")+"-error");t.setAttribute("class","");o=document.createTextNode(u[i]);t.appendChild(o);f.addClass("field-validation-error");f.removeClass("field-validation-valid");f.html(t);i++})}function ajaxPostCurrentSection(n,t){var i=$("#Dynamic form");if(i.validate({lang:"pl"}),i.valid()){var u=i.attr("action"),f=i.attr("data-ajax-method"),e=i.attr("data-ajax"),r=$.ajax({type:f||"POST",url:u,data:i.serialize()});r.fail(n);r.done(t);r.done(function(){WgTools.alert("Pomyślnie zapisano dane sekcji",!0,"S")})}}function btnAddOwner(){ajaxPostCurrentSection(onAjaxPostError,function(){WgTools.alert("Pomyślnie zapisano dane sekcji",!0,"S");var n=$.ajax({url:"/InvestmentOwners/CreatePersonAjax",data:{investmentId:$("#InvestmentId").val()},type:"GET",dataType:"html"});n.done(function(n,t){onAjaxGetSuccess(n,t)});n.fail(function(n,t,i){onAjaxGetFailure(n,t,i)})})}function removeOwner(){var i;$("#DeleteOwnerModal").modal("hide");$("div.modal-backdrop").remove();var r=$("#InvestmentId").val(),n=$("#Owner_BusinessPartnerId").val(),t=$("#Dynamic form").attr("id").split("_"),u=t[1],f=t[2];n!=="00000000-0000-0000-0000-000000000000"?(i=$.ajax({type:"POST",url:"/InvestmentOwners/DeletePersonAjax",data:{investmentId:r,ownerId:n}}),i.done(ajaxGetPrevSection)):ajaxGetPrevSection()}function onAddRoof(){ajaxPostCurrentSection(onAjaxPostError,function(){WgTools.alert("Pomyślnie zapisano dane sekcji",!0,"S");var n=$.ajax({url:"/Surveys/CreateRoofPLaneAjax",data:{surveyId:$("#SurveyId").val()},type:"GET",dataType:"html"});n.done(function(n,t){onAjaxGetSuccess(n,t)});n.fail(function(n,t,i){onAjaxGetFailure(n,t,i)})})}function onRemoveRoof(){var i;$("#DeleteRoofModal").modal("hide");$("div.modal-backdrop").remove();var r=$("#SurveyId").val(),n=$("#Plane_RoofPlaneId").val(),t=$("#Dynamic form").attr("id").split("_"),u=t[1],f=t[2];n!=="00000000-0000-0000-0000-000000000000"?(i=$.ajax({type:"POST",url:"/Surveys/DeleteRoofPlaneAjax",data:{surveyId:r,roofPlaneId:n}}),i.done(ajaxGetPrevSection)):ajaxGetPrevSection()}function onRoofTypeChange(){var i=$(this).val(),n="roof_0p.jpg",t;switch(i){case"0":n="roof_0p.jpg";break;case"1":n="roof_1p.png";break;case"2":n="roof_2p.png";break;case"3":n="roof_4p.png"}t=new Date;$("img.roof-thumbnail").attr("src","/images/"+n+"?"+t.getTime())}function NavigationPrev(n){var t=$("#SurveyInspectionDateTime"),i,r;if(t.length===0||(t.validate({lang:"pl"}),t.valid())){if(i=$("#Dynamic form").attr("id"),i==="SurveyPhoto"){ajaxGetPrevSection();return}r=n.data.save;r?ajaxPostCurrentSection(onAjaxPostError,ajaxGetPrevSection):(ajaxGetPrevSection(),$("#stepSave").addClass("hidden"))}}function NavigationNext(n){var t=$("#SurveyInspectionDateTime"),i;(t.length===0||(t.validate({lang:"pl"}),t.valid()))&&(i=n.data.save,i?ajaxPostCurrentSection(onAjaxPostError,ajaxGetNextSection):(ajaxGetNextSection(),$("#stepSave").addClass("hidden")))}function NavigationSave(){ajaxPostCurrentSection(onAjaxPostError,function(){$("#stepSave").addClass("hidden")})}function NavigationLast(n){var i=n.data.save,t;i?(t=$("#Dynamic form").first(),t.validate({lang:"pl"}),t.valid()&&t.submit()):document.getElementById("stepCancel").click()}function onFormChanged(){var n=$("#stepSave");n.length!==0&&n.removeClass("hidden")}function optionBtnTrue(){var i=$(this).attr("data-linked-checkbox"),n,t;$('input[name="'+i+'"]').val("True");n=$(this).attr("data-link-show-element");t=$(this).attr("data-link-hide-element");n!==""&&$(n).collapse("show");t!==""&&$(t).collapse("hide")}function optionBtnFalse(){var i=$(this).attr("data-linked-checkbox"),n,t;$('input[name="'+i+'"]').val("False");n=$(this).attr("data-link-show-element");t=$(this).attr("data-link-hide-element");n!==""&&$(n).collapse("show");t!==""&&$(t).collapse("hide")}function onPhotoLinkClick(n){var t=$(this);t.attr("href")||(n.stopPropagation(),t.siblings("form").children('input[type="file"]').first().click())}function onPhotoInputChanged(){var n=$(this),t="",i="";n.val()!==undefined&&(n.attr("name")==="Picture0"||n.attr("name")==="Picture5"||n.attr("name")==="Picture10"?(t="Investment",i=$("#Dynamic form input[name='InvestmentId']").val()):(t="Survey",i=$("#Dynamic form input[name='SurveyId']").val()),UploadPhoto(t,i,n.attr("name"),n[0].files[0]))}function onPhotoDeleteClick(){var t=$(this).siblings("a").first().children("img").first().attr("src"),n=t.split("/");if(n.reverse(),n.length>=4){var i=n[0],r=n[1],u=n[2],f=n[3];DeletePhoto(f,u,r,i)}}function UploadPhoto(n,t,i,r){var u=new FormData,f;u.append("type",n);u.append("guid",t);u.append(i,r);f=$.ajax({url:"/Files/UploadPhoto",type:"POST",cache:!1,contentType:!1,processData:!1,data:u,beforeSend:function(){turnPhotoLoader(i,!0)}});f.done(function(n,t){onUploadPhotoCompleted(n,t,i);turnPhotoLoader(i,!1)});f.fail(function(n,t,i){onUploadPhotoFailed(n,t,i)})}function turnPhotoLoader(n,t){var r=$('a[name="'+n+'"]'),i=r.children("img").first();t?(i.removeClass("wg-image-placeholder"),i.addClass("wg-loader")):(i.removeClass("wg-loader"),i.addClass("wg-image-placeholder"))}function onUploadPhotoCompleted(n,t,i){var u=n,r=$('a[name="'+i+'"]');r.attr("href",u);r.attr("target","_blank");r.children("img").first().attr("src",u);r.siblings("button.photo-delete").first().removeAttr("hidden");r.siblings("button.photo-delete").first().show()}function onUploadPhotoFailed(n,t,i){WgTools.alert(i,!0,"E")}function DeletePhoto(n,t,i,r){var u=new FormData,f;u.append("type",n);u.append("guid",t);u.append("pictureId",i);u.append("fileName",r);f=$.ajax({url:"/Files/DeletePhoto",type:"POST",cache:!1,contentType:!1,processData:!1,data:u});f.done(function(n,t){onDeletePhotoCompleted(n,t,i)});f.fail(function(n,t,i){onDeletePhotoFailed(n,t,i)})}function onDeletePhotoCompleted(n,t,i){var r=$('a[name="'+i+'"]');r.removeAttr("href");r.removeAttr("target");r.children("img").first().attr("src","");r.children("img").first().attr("alt","Dodaj zdjęcie");r.siblings("button.photo-delete").first().hide();r.siblings("form").first().children('input[type="file"]').first().val("")}function onDeletePhotoFailed(n,t,i){WgTools.alert(i,!0,"E")}function onInspectionDateTimeChange(){var n=$("#SurveyInspectionDateTime");n.length!=0&&(n.validate({lang:"pl"}),n.valid()&&n.submit())}function InspectionDateTimePostFailure(){}function InspectionDateTimePostSuccess(){}$("body").on("change",".insulationtype",onCHInsTypeChange);$("body").on("change",".centralheating-type",onCHTypeChange);var stepNo;$("body").on("click",".navigation-bar-link",{save:!1},onNavigationBarClick);$("body").on("click",".navigation-bar-link-save",{save:!0},onNavigationBarClick);$("body").on("change",".wallarea",onWallSizeChange);$("body").on("change",".boilerroomvolume",onBoilerRoomSizeChange);$("body").on("change","#Localization",plndInstallChanged);$("body").on("click",".addowner",btnAddOwner);$("body").on("click",".deleteownersubmit",removeOwner);$("body").on("click",".addroof",onAddRoof);$("body").on("click",".deleteroofsubmit",onRemoveRoof);$("body").on("change",".roof-type",onRoofTypeChange);$("body").on("change","#Dynamic form :input",onFormChanged);$("body").on("click","#stepNext",{save:!1},NavigationNext);$("body").on("click","#stepPrev",{save:!1},NavigationPrev);$("body").on("click","#stepLast",{save:!1},NavigationLast);$("body").on("click","#stepSave",NavigationSave);$("body").on("click","#stepNextSave",{save:!0},NavigationNext);$("body").on("click","#stepPrevSave",{save:!0},NavigationPrev);$("body").on("click","#stepLastSave",{save:!0},NavigationLast);$("body").on("change",".optionbutton-true",optionBtnTrue);$("body").on("change",".optionbutton-false",optionBtnFalse);$("body").on("change",".photo-input",onPhotoInputChanged);$("body").on("click",".photo-link",onPhotoLinkClick);$("body").on("click",".photo-delete",onPhotoDeleteClick);$("body").on("change",".inspectiondatetime",onInspectionDateTimeChange);