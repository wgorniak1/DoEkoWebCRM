"use strict";function InitializeTaxTab(n){var t="/api/v1/RSERules/Tax?projectId="+n,i=$("#TaxTable").DataTable({ajax:{url:t,dataSrc:""},columnDefs:[{className:"text-right",targets:[3,4,5]}],columns:[{data:null,name:"rseType",title:"Typ OZE",type:"html",render:function(n){return WgEnums.rse.getText(n.surveyType,n.rseType)}},{data:"installationLocalization",name:"installationLocalization",title:"Lokalizacja",render:function(n){return WgEnums.localization.getText(n)}},{data:"buildingPurpose",name:"buildingPurpose",title:"Przezn. Budynku",render:function(n){return WgEnums.building.getText(n)}},{data:"usableAreaMin",name:"usableAreaMin",title:"Powierzchnia Od",type:"html-num",render:function(n,t){switch(t){case"display":var i='<input type="number" class="form-control input-sm wg-area-min" value="'+n+'" step="0.1" min="0.0" max="99999.9" disabled>';return WgTaxTableEdit===!0?i:n;default:return n}}},{data:"usableAreaMax",name:"usableAreaMax",title:"Powierzchnia Do",type:"html-num",render:function(n,t){var i=n===Number.MAX_VALUE?"99999.99":n,r;switch(t){case"display":return r='<input type="number" class="form-control input-sm wg-area-max" value="'+i+'" step="0.1" min="0.0" max="99999.9">',WgTaxTableEdit===!0?r:i;default:return i}}},{data:"vat",name:"vat",title:"VAT",type:"html-num-fmt",render:function(n,t){switch(t){case"display":return $("<select>",{name:"vat","class":"form-control input-sm",disabled:!WgTaxTableEdit}).addOptions([{val:"0",text:"0 %"},{val:"5",text:"5 %"},{val:"8",text:"8 %"},{val:"23",text:"23 %"}],n).prop("outerHTML");default:return n}}}],stateSave:!1,pagingType:"full",language:WgLanguage,lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"Wszystkie"]],order:[[0,"asc"],[1,"asc"],[2,"asc"],[3,"asc"],[4,"asc"]],processing:!0,dom:"<'row wg-dt-padding'<'col-sm-6'B><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row wg-dt-padding'<'col-sm-4'l><'col-sm-4'i><'col-sm-4'p>>",buttons:[{text:'<span class="text-primary glyphicon glyphicon glyphicon-retweet"><\/span> Przywróć',titleAttr:"Przywróć ustawienia domyślne",className:"btn",action:function(n,i){var u,r;i.table().buttons().disable();u=$("div#TaxTable_processing");u.show();r=$.ajax({url:t,type:"DELETE",data:{},contentType:"application/json"});r.done(function(){i.table().buttons().enable();i.ajax.reload();i.rows().cells().invalidate().render();WgTools.alert("Pomyślnie przywrócono wartości początkowe.",!1,"S")});r.fail(function(){WgTools.alert("Coś poszło nie tak. Proszę skontaktować się z administratorem strony.",!1,"E")})}},{text:'<span class="text-primary glyphicon glyphicon-refresh"><\/span>',titleAttr:"Odśwież zawartość",className:"btn",action:function(n,t){t.ajax.reload();t.rows().cells().invalidate().render()}},{text:'<span class="text-primary glyphicon glyphicon glyphicon-resize-full"><\/span> Podziel',titleAttr:"Podziel przedział powierzchni",className:"btn",action:function(){var i=$("#TaxTable").dataTable().api(),t=i.eq(0).row({selected:!0,page:"current"}),u;if(t!==undefined){var n=t.data(),r=n.usableAreaMax-(n.usableAreaMax-n.usableAreaMin)/2,f=i.row.add({project:null,projectId:n.projectId,surveyType:n.surveyType,rseType:n.rseType,installationLocalization:n.installationLocalization,buildingPurpose:n.buildingPurpose,usableAreaMin:r,usableAreaMax:n.usableAreaMax,vat:n.vat}).invalidate().draw().node();n.usableAreaMax=r;u=t.invalidate().draw().node()}}}],select:"single",responsive:!0,fixedHeader:{headerOffset:$("#NavBarMain").outerHeight()}});$("body").on("change","input.wg-area-max",function(){var n=$(this).parents("tr").next("tr").children("td").find("input.wg-area-min");n.val($(this).val())})}function InitializeNetTab(n){var i="/api/v1/RSERules/Price?projectId="+n,t=$("#NetTable").DataTable({ajax:{url:i,dataSrc:""},columns:[{data:null,name:"rseType",title:"Typ OZE",type:"html",render:function(n){return WgEnums.rse.getText(n.surveyType,n.rseType)}},{data:"unit",name:"unit",title:"Jednostka",type:"html",render:function(n,t){switch(t){case"display":var i=$("<select />",{name:"unit","class":"form-control input-sm unit",disabled:!WgNetTableEdit}).addOptions([{val:"1",text:"Moc ostateczna"},{val:"2",text:"Liczba zestawów"}],n+"").addClass(WgNetTableEdit===!0?"":"disabled");return i.prop("outerHTML");default:return n}}},{data:"numberMin",name:"numberMin",title:"Od",type:"html-num",render:function(n,t){switch(t){case"display":var i='<input type="number" name="numberMin" class="form-control input-sm" value="'+n+'" step="0.1" min="0.0" max="99999.9" disabled>';return WgNetTableEdit===!0?i:n;default:return n}}},{data:"numberMax",name:"numberMax",title:"Do",type:"html-num",render:function(n,t,i){n===Number.MAX_VALUE&&(n="99999.99");switch(t){case"display":var r=i.unit===1?.1:1,u='<input type="number" style="width: 100%; min-width: 30px; max-width: 100px;" name="numberMax" class="form-control input-sm number-max" value="'+n+'" step="'+r+'" min="0.0" max="99999.9">';return WgNetTableEdit===!0?u:n;default:return n}}},{data:"netPrice",name:"netPrice",title:"Cena Netto",type:"html-num",render:function(n,t){switch(t){case"display":var i;return i='<input type="number" name="netPrice" min="0" max="99999" step="1" class="form-control input-sm" value="'+n+'"/>',WgNetTableEdit===!0?i:n;default:return n}}},{data:"multiply",name:"multiply",title:"cena jednostkowa",type:"html",render:function(n,t){switch(t){case"display":var i;return i='<input name="multiply"  class="form-control input-sm checkbox"  data-toggle="toggle" data-on="Tak" data-off="Nie" type="checkbox"',i+=n===!0?" checked />":"/>",WgNetTableEdit===!0?i:n;default:return n}}}],stateSave:!0,pagingType:"full",language:WgLanguage,lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"Wszystkie"]],order:[[0,"asc"],[1,"asc"],[2,"asc"],[3,"asc"],[4,"asc"],[5,"asc"]],processing:!0,dom:"<'row wg-dt-padding'<'col-sm-6'B><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row wg-dt-padding'<'col-sm-4'l><'col-sm-4'i><'col-sm-4'p>>",buttons:[{text:"draw",action:function(n,t){t.draw()}},{text:'<span class="text-primary glyphicon glyphicon glyphicon-retweet"><\/span> Przywróć',titleAttr:"Przywróć ustawienia domyślne",className:"btn",action:function(n,t){var u,r;t.table().buttons().disable();u=$("div#NetTable_processing");u.show();r=$.ajax({url:i,type:"DELETE",data:{},contentType:"application/json"});r.done(function(){t.table().buttons().enable();t.ajax.reload();t.rows().cells().invalidate().render();WgTools.alert("Pomyślnie przywrócono wartości początkowe.",!1,"S")});r.fail(function(){WgTools.alert("Coś poszło nie tak. Proszę skontaktować się z administratorem strony.",!1,"E")})}},{text:'<span class="text-primary glyphicon glyphicon-refresh"><\/span>',titleAttr:"Odśwież zawartość",className:"btn",action:function(n,t){t.ajax.reload();t.rows().cells().invalidate().render()}},{text:'<span class="text-primary glyphicon glyphicon glyphicon-resize-full"><\/span> Podziel',titleAttr:"Podziel przedział wartości",className:"btn",action:function(n,t){var r=t.row({selected:!0,page:"current"}),e=r.index(),i=r.data(),u=i.numberMax-(i.numberMax-i.numberMin)/2,f=t.row.add({project:null,projectId:i.projectId,surveyType:i.surveyType,rseType:i.rseType,unit:i.unit,numberMin:u,numberMax:i.numberMax,netPrice:i.netPrice,multiply:i.multiply});i.numberMax=u;f.invalidate();r.invalidate().draw()}},{text:'<span class="text-primary glyphicon glyphicon glyphicon-resize-small"><\/span> Usuń',titleAttr:"Usuń przedział wartości",className:"btn",action:function(n,t){var u=t.row({selected:!0,page:"current"}),i,r;u!==undefined&&(i=u.data(),i.numberMin!==0)&&(r=t.rows(function(n,t){return t.surveyType===i.surveyType&&t.rseType===i.rseType&&t.numberMax<i.numberMax?!0:!1}),r.length>0&&(r.data()[r.count()-1].numberMax=i.numberMax,r.invalidate()),u.remove().draw())}}],select:"single",responsive:!0,fixedHeader:{headerOffset:$("#NavBarMain").outerHeight()},drawCallback:function(){var o=$("#NetTable tbody"),t=$("#NetTable").dataTable().api(),i,e,r;for($('input[data-toggle="toggle"]',o).bootstrapToggle(),i=0;i<t.rows().count();i++){var u=t.row(i),n=u.data(),f=t.row(function(t,i){return i.surveyType===n.surveyType&&i.rseType===n.rseType&&i.numberMax>n.numberMax?!0:!1}).data();f!==undefined&&(e=f.numberMax>=Number.MAX_VALUE?99999.98:Number.parseFloat(f.numberMax)-.1,$('input[name="numberMax"]',$(u.node())).attr("max",e));r=t.rows(function(t,i){return i.surveyType===n.surveyType&&i.rseType===n.rseType&&i.numberMax<n.numberMax?!0:!1}).data();r.length>0&&$('input[name="numberMax"]',$(u.node())).attr("min",Number.parseFloat(r[r.length-1].numberMax)+.1)}}});$("#NetTable tbody").on("change",".unit",t,function(n){var t=n.data,r=$(this).val(),i=t.row($(this).parent()).data();t.rows(function(n,t){return t.surveyType===i.surveyType&&t.rseType===i.rseType?!0:!1}).every(function(){this.data().unit=parseInt(r);this.invalidate()}).draw();t.draw();n.stopPropagation()});class r{constructor(n){this.value=parseFloat(n.val());this.max=parseFloat(n.attr("max"));this.min=parseFloat(n.attr("min"))}isValid(){return this.value<=this.max&&this.value>=this.min?!0:!1}get value(){return this.value>=this.max?this.max:this.value<=this.min?this.min:this.value}}$("#NetTable tbody").on("change",".number-max",t,function(n){var i=$(this),r=parseFloat(i.val()),f={min:parseFloat(i.attr("min")),max:parseFloat(i.attr("max"))},e,t,u;(r<f.min?i.val(f.min):r>f.max&&i.val(f.max),e=n.data.row($(this).parent()),t=e.data(),t.numberMax!==r)&&(u=n.data.row(function(n,i){return i.surveyType===t.surveyType&&i.rseType===t.rseType&&i.numberMax>t.numberMax?!0:!1}),t.numberMax=r,u.length>0&&(u.data().numberMin=r,u.invalidate(),u.draw(!1)),n.stopPropagation())});$("#NetTable tbody").on("click","input, select, label",t,function(n){n.stopPropagation()})}(function(n){n.fn.addOptions=function(t,i){return!t||Object.values(t[0]).length<2?this:this.filter("select").each(function(){var r=this;n(t).each(function(){var t=Object.values(this);n("<option/>",t[0]===i?{value:t[0],selected:!0}:{value:t[0]}).text(t[1]).appendTo(r)})})}})(jQuery);class mySelect{}class WgRSEEnum{constructor(){this.surveyType=["CO","CWU","EE"];this.rseType=[["","Pompa Ciepła Grunt.","Kocioł na Pellet","Pompa Ciepła Powietrzna"],["","","","Solary","Pompa Ciepła"],["","","","","","Panele Fotowolt."]]}getText(n,t,i){return t===undefined?this.surveyType[n]:i?this.rseType[n][t]:this.rseType[n][t]+" ("+this.surveyType[n]+")"}getId(n,t){for(var u,r=-1,f=-1,i=0;i<this.surveyType.length;i++)this.surveyType[i]===n&&(r=i);if(t===undefined)return r;if(r>=0)for(u=0;u<this.rseType[r].length;u++)this.surveyType[r][i]===n&&(f=i);return f}}class WgLocEnum{constructor(){this._array=["Dach","Grunt","Elewacja"]}getText(n){return this._array[n]}getValue(n){for(var t=0;t<this._array.length;t++)if(this._array[t]===n)return t}}class WgBdgEnum{constructor(){this._array=["Gospodarczy","Mieszkalny"]}getText(n){return this._array[n]}getValue(n){for(var t=0;t<this._array.length;t++)if(this._array[t]===n)return t}}var WgEnums={rse:new WgRSEEnum,localization:new WgLocEnum,building:new WgBdgEnum},WgTaxTableEdit=!0,WgNetTableEdit=!0;$(document).ready(function(){var n=$("#TaxTable").data("projectid");InitializeTaxTab(n);InitializeNetTab(n);$("#TabsContainer ul li a").click(function(){var n=$(this).attr("href"),t=$("table",$(n)).attr("id"),i=$("#"+t).dataTable().api();new $.fn.dataTable.FixedHeader(i,{headerOffset:$("#NavBarMain").outerHeight()})})});