"use strict";$(document).ready(function(){var n=new application;n.main()});class GetAllInput{constructor(n,t,i,r){this.skipCount=n||0;this.totalCount=t||2147483647;let u=$.map(i,n=>r[n.column].name+" "+n.dir.toUpperCase());this.sorting=u.join()||""}}class TextIdDictionary extends Map{setAll(n){super.clear();for(var t=0;t<n.length;t++)this.set(n[t].key,n[t].value)}Id(n){super.forEach(function(t){if(t.value===n)return t.key})}Text(n){return super.get(n)}}class KeyValuePair{constructor(n,t){this._key=n;this._value=t}get Text(){return this._key}get Key(){return this._key}get Value(){return this._value}}class WGENUMS{constructor(){this._url="/api/v1/Projects/Dictionary";this._projectstatus=new TextIdDictionary;var n=this;$.ajax({async:!1,type:"GET",url:this._url+"/Status",success:function(t){n._projectstatus.setAll(t)}})}get ProjectStatus(){return this._projectstatus}}class application{constructor(){this._initialized=!1;this.$table=$("#ProjectList");this.url="/api/v1/Projects";this.enums=new WGENUMS}main(){if(!this._initialized){var n=this;this.$table.DataTable({ajax:function(n,t){var i={draw:0,recordsTotal:0,recordsFiltered:0,data:[]},u=this.api().columns(".summary").visible()[0];let f=$("#name").val(),e=$("#status").val(),r=new GetAllInput(n.start,n.length,n.order,n.columns);r.search=f;r.status=e;$.get("api/v1/Projects",r).done(function(r){var e=[],f;if(u)for(f=0;f<r.items.length;f++){let t=r.items[f],n="api/v1/Projects/"+t.projectId;e.push($.get({url:n+"/totalrse",itemNo:f}).done(function(n){let t=r.items[this.itemNo];t.totalRse=n}));e.push($.get({url:n+"/totalpower",itemNo:f}).done(function(n){let t=r.items[this.itemNo];t.totalPower=n}));e.push($.get({url:n+"/totalcost",itemNo:f}).done(function(n){let t=r.items[this.itemNo];t.totalPrice=n}))}$.when.apply($,e).then(function(){i.draw=n.draw;i.recordsTotal=r.totalCount;i.recordsFiltered=r.filteredCount;i.data=r.items;t(i)})}).fail(function(){i.draw=n.draw;i.recordsTotal=0;i.recordsFiltered=0;i.data=[];t(i)})},columns:[{data:"projectId",name:"ProjectId",title:"Nr",type:"number",visible:!0,orderable:!0},{data:"shortDescription",name:"ShortDescription",title:"Nazwa",type:"html",orderable:!0,render:function(n,t,i){switch(t){case"display":return'<a href="/Projects/Details/'+i.projectId+'" class="">'+i.shortDescription+"<\/a>";default:return i.shortDescription}}},{data:null,name:"parentProjectId",title:"Projekt Nadrzędny",type:"html",orderable:!0,render:function(n,t,i){if(i.parentProjectId===null)return"";switch(t){case"display":return'<a href="/Projects/Details/'+i.parentProjectId+'" class="">'+i.parentProject.shortDescription+"<\/a>";default:return i.parentProject.shortDescription}}},{data:"status",name:"status",title:"Status",orderable:!0,render:function(t,i){switch(i){case"display":case"filter":return n.enums.ProjectStatus.Text(t);default:return t}}},{data:null,name:"totalRSE",title:"Liczba źródeł",type:"html-num",orderable:!1,className:"summary",render:function(n,t,i){if(i.totalRse===undefined)return"";n=i.totalRse;switch(t){case"display":return n;default:return n}}},{data:null,name:"TotalPower",title:"Moc całkowita",type:"html-num",orderable:!1,className:"summary",render:function(n,t,i){if(i.totalPower===undefined)return"";n=i.totalPower;switch(t){case"display":if(n>1e3){let t=(n/1e3).toFixed(2);return"<span>"+t.toString()+" MW<\/span>"}let t=n.toFixed(2);return"<span>"+t.toString()+" kW<\/span>";default:return n}}},{data:null,name:"TotalPrice",title:"Kwota",type:"html-num",className:"summary",orderable:!1,render:function(n,t,i){if(i.totalPrice===undefined)return"";n=i.totalPrice;switch(t){case"display":if(n>1e6){let t=(n/1e6).toFixed(2);return"<span>"+t+" mln PLN<\/span>"}if(n>1e3){let t=(n/1e6).toFixed(2);return"<span>"+t+" tys. PLN<\/span>"}let t=n.toFixed(2);return"<span>"+t+" tys. PLN<\/span>";default:return n}}},{data:null,name:"Actions",title:"Akcje",type:"html",orderable:!1,render:function(n,t,i){let r='<a href="/Projects/Edit/'+i.projectId+'" class="btn btn-sm btn-primary"><span class="small glyphicon glyphicon-pencil"><\/span><\/a>',u='<a href="/Projects/Delete/'+i.projectId+'" class="btn btn-sm btn-danger"><span class="small glyphicon glyphicon-trash"><\/span><\/a>';return r+"|"+u}}],stateSave:!0,paging:!0,pageLength:8,lengthChange:!0,language:WgLanguage,ordering:!0,order:[["0","asc"]],processing:!0,serverSide:!0,dom:"<'row'<'col-sm-12'tr>><'row'<'col-sm-6'i><'col-sm-6'p>>",responsive:!0,fixedHeader:{headerOffset:$("#NavBarMain").outerHeight()}});this.attachEvents()}}attachEvents(){this._initialized||($("#projectList-filter").click(n=>{n.preventDefault();$("button",$("#toolbar")).attr("disabled",!0);let t=this.$table.DataTable();t.ajax.reload();t.rows().cells().invalidate().render();$("button",$("#toolbar")).removeAttr("disabled")}),$("#projectList-refresh").click(n=>{n.preventDefault();$("button",$("#toolbar")).attr("disabled",!0);let t=this.$table.DataTable();t.ajax.reload();t.rows().cells().invalidate().render();$("button",$("#toolbar")).removeAttr("disabled")}),$("#projectList-summary").click(n=>{n.preventDefault();$("button",$("#toolbar")).attr("disabled",!0);let t=this.$table.DataTable(),i=t.columns(".summary").visible()[0];t.columns(".summary").visible(!i);t.columns.adjust().draw(!1);$("button",$("#toolbar")).removeAttr("disabled")}))}}class DTOptions{}