"use strict";function InitializeSurveyListTab(n){var t="/api/v1/Survey?investmentId="+n,i=$("#SurveyListTable").DataTable({ajax:{url:t,dataSrc:"",rowId:"surveyId"},columns:[{data:null,name:"rseType",title:"Typ OZE",render:function(n){return WgEnums.rse.getText(n.type,n.rseType)}},{data:"status",name:"status",title:"Status inspekcji",type:"html",render:function(n,t,i){return'<span title="'+(n===5?WgEnums.cancel.getText(i.cancelType):"")+'">'+WgEnums.status.getText(n)+"<\/span>"}},{data:"changedAt",name:"changedAt",title:"Ost.Zmiana",type:"datetime",render:function(n,t){var i=new Date(n);switch(t){case"display":return i.toLocaleString();default:return i}}},{data:"resultCalculation.completed",name:"completed",title:"Zakończono obliczenia",render:function(n){return n===!0?"Tak":"Nie"}},{data:"resultCalculation.rseNetPrice",name:"netPrice",title:"Cena Netto",type:"num-fmt",render:function(n,t){switch(t){case"display":return parseFloat(n).toFixed(2)+" zł";default:return parseFloat(n).toFixed(2)}}},{data:"resultCalculation.rseTax",name:"taxPrice",title:"VAT",type:"num-fmt",render:function(n,t){switch(t){case"display":return parseFloat(n).toFixed(2)+" zł";default:return parseFloat(n).toFixed(2)}}},{data:"resultCalculation.rseGrossPrice",name:"grossPrice",title:"Cena Brutto",type:"num-fmt",render:function(n,t){switch(t){case"display":return parseFloat(n).toFixed(2)+" zł";default:return parseFloat(n).toFixed(2)}}},{data:"resultCalculation.rseOwnerContrib",name:"ownerContrib",title:"Udział własny",type:"num-fmt",render:function(n,t){switch(t){case"display":return parseFloat(n).toFixed(2)+" zł";default:return parseFloat(n).toFixed(2)}}},{data:"resultCalculation.finalRSEPower",name:"FinalPower",title:"Dobrana Moc",type:"html-num-fmt",render:function(n,t,i){switch(t){case"display":switch(i.type.toString()+i.rseType.toString()){case"13":return'<span title="'+i.finalSolConfig+'">'+parseFloat(n).toFixed(2)+" KW <\/span>";case"25":default:return"<span>"+parseFloat(n).toFixed(2)+" KW<\/span>"}default:return n}}},{data:null,className:"all",name:"actions",title:"Akcje",orderable:!1,searchable:!1,type:"html",autoWidth:!1,visible:!0,render:function(n,t,i){var r="",f=$("#SurveyListTable").data("admin"),u="btn btn-default btn-sm";i.investment.status===2&&(u=u+" disabled");r='<div class="pull-right">';f===!0&&(r+='<button class="'+u+'"',r+=' data-toggle="modal"',r+=' data-target="#SrvMoveModal"',r+=' data-survey-id="'+i.surveyId+'"',r+=' type="button">',r+='<span class="glyphicon glyphicon-transfer"><\/span>',r+="<\/button>");switch(i.status){case 0:r+='<a href="/Surveys/Maintain/'+i.surveyId+'"';r+=' class="btn btn-default btn-sm">';r+='<span class="glyphicon glyphicon-eye-open"><\/span>';r+="<\/a>";r+='<button class="'+u+'"';r+=' data-toggle="modal"';r+=' data-target="#SrvCancelModal"';r+=' data-survey-id="'+i.surveyId+'"';r+=' type="button">';r+='<span class="glyphicon glyphicon-ban-circle"><\/span>';r+="<\/button>";break;case 1:r+='<a href="/Surveys/Maintain/'+i.surveyId+'"';r+=' class="'+u+'" title="Edytuj ankietę">';r+=' <span class="glyphicon glyphicon-eye-open"><\/span>';r+="<\/a>";r+='<button class="'+u+'"';r+=' data-toggle="modal"';r+=' data-target="#SrvCancelModal"';r+=' data-survey-id="'+i.surveyId+'"';r+=' type="button"';r+=' title="Anuluj ankietę">';r+='<span class="glyphicon glyphicon-ban-circle"><\/span>';r+="<\/button>";r+='<button class="'+u+'"';r+=' data-toggle="modal"';r+=' data-target="#SrvSubmitModal"';r+=' data-survey-id="'+i.surveyId+'"';r+=' type="button"';r+=' title="Zakończ wprowadzanie ';r+='(Wyślij do akceptacji)">';r+='<span class="glyphicon glyphicon-send"><\/span>';r+="<\/button>";break;case 2:f&&(r+='<a href="/Surveys/Maintain/'+i.surveyId+'"',r+=' class="'+u+'">',r+='<span class="glyphicon glyphicon-eye-open"><\/span>',r+="<\/a>",r+='<button class="'+u+'"',r+=' data-toggle="modal"',r+=' data-target="#SrvCancelModal"',r+=' data-survey-id="'+i.surveyId+'"',r+=' type="button"',r+=' title="Anuluj ankietę">',r+='<span class="glyphicon glyphicon-ban-circle"><\/span>',r+="<\/button>",r+='<button class="'+u+'"',r+=' data-toggle="modal"',r+=' data-target="#SrvApprovalModal"',r+=' data-survey-id="'+i.surveyId+'"',r+=' type="button"',r+=' title="Zatwierdź ankietę">',r+='<span class="glyphicon glyphicon-ok-circle"><\/span>',r+="<\/button>",r+='<button class="'+u+'"',r+=' data-toggle="modal"',r+=' data-target="#SrvRejectModal"',r+=' data-survey-id="'+i.surveyId+'"',r+=' type="button"',r+=' title="Odrzuć ankietę">',r+='<span class="glyphicon glyphicon-remove-circle"><\/span>',r+="<\/button>");break;case 3:r+='<a href="/Surveys/Maintain/'+i.surveyId+'"';r+=' class="'+u+'">';r+='<span class="glyphicon glyphicon-eye-open"><\/span>';r+="<\/a>";f&&(r+='<button class="'+u+'"',r+=' data-toggle="modal"',r+=' data-target="#SrvCancelModal"',r+=' data-survey-id="'+i.surveyId+'"',r+=' type="button"',r+=' title="Anuluj Ankietę">',r+='<span class="glyphicon glyphicon-ban-circle"><\/span>',r+="<\/button>");break;case 4:f&&(r+='<a href="/Surveys/Maintain/'+i.surveyId+'"',r+=' class="'+u+'" title="Edytuj ankietę">',r+=' <span class="glyphicon glyphicon-eye-open"><\/span>',r+="<\/a>",r+='<button class="'+u+'"',r+=' data-toggle="modal"',r+=' data-target="#SrvCancelModal"',r+=' data-survey-id="'+i.surveyId+'"',r+=' type="button"',r+=' title="Anuluj Ankietę">',r+='<span class="glyphicon glyphicon-ban-circle"><\/span>',r+="<\/button>");break;case 5:f&&(r+='<a href="/Surveys/Maintain/'+i.surveyId+'"',r+=' class="'+u+'" title="Edytuj ankietę">',r+='<span class="glyphicon glyphicon-eye-open"><\/span>',r+="<\/a>",r+='<button class="'+u+'"',r+=' data-toggle="modal"',r+=' data-target="#SrvRevertModal"',r+=' data-survey-id="'+i.surveyId+'"',r+=' type="button"',r+=' title="Przywróć ankietę">',r+='<span class="glyphicon glyphicon-repeat"><\/span>',r+="<\/button>")}return r+"<\/div>"}}],stateSave:!0,pagingType:"full",language:WgLanguage,lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"Wszystkie"]],order:[[0,"asc"],[1,"asc"],[2,"asc"],[3,"asc"],[4,"asc"]],processing:!0,dom:"<'row wg-dt-padding'<'col-sm-6'B><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row wg-dt-padding'<'col-sm-4'l><'col-sm-4'i><'col-sm-4'p>>",buttons:[{extend:"colvis",text:'<span class="text-primary glyphicon glyphicon-th-list" title="Pokaż / Ukryj kolumny"><\/span>',className:"btn-sm"},{text:'<span class="text-primary glyphicon glyphicon-refresh" title="Odśwież zawartość"><\/span>',className:"btn-sm",action:function(n,t){t.ajax.reload();t.columns.adjust().draw()}},],fixedHeader:{headerOffset:$("#NavBarMain").outerHeight()}})}function onSurveyMoveModalShowButtonClick(){var n=$(this).data("survey-id"),t=$("#SurveyMoveModalForm"),i=$("#SurveyId",t);i.val(n)}function onSurveyMoveModalCancelButtonClick(){var n=document.getElementById("SurveyMoveModalForm");n.reset()}function onSurveyMoveModalSubmitButtonClick(){ajaxSurveyMovePost()}function onAjaxSurveyMoveCompleted(n){WgTools.alert(n,!0,"S");setTimeout(window.location.reload(),4e3)}function onAjaxSurveyMoveFailed(n,t,i){WgTools.alert(i,!1,"E")}function ajaxSurveyMovePost(){var n=$("#SurveyMoveModalForm"),i=$("#SurveyId",n),r=$("#InvestmentId",n),t=$.ajax({type:"POST",url:"/Surveys/Move",data:n.serialize()});t.done(function(n,t){onAjaxSurveyMoveCompleted(n,t)});t.fail(function(n,t,i){onAjaxSurveyMoveFailed(n,t,i)})}function onInvestmentDetailsSave(){var n=$("#InvestmentDetailsForm"),i=$("#InvestmentId",n);if(n.validate({lang:"pl"}),n.valid()){var r="/Investments/PutInvestment/"+i.val(),u=n.serialize(),t=$.ajax({url:r,type:"POST",data:u});t.fail(function(){WgTools.alert("Wystąpił problem podczas zapisu",!1,"E")});t.done(function(){onInvestmentDetailsCancel()});t.done(function(){WgTools.alert("Pomyślnie zapisano dane sekcji",!0,"S")})}}function onInvestmentDetailsCancel(){var t=$("#InvestmentDetailsForm"),i=$("#InvestmentId",t),n=$.ajax({type:"GET",url:"/Investments/DetailsAjax",data:{id:i.val()},dataType:"html"});n.done(function(n){$("#details .panel-body").html(n);$("button.investment-details-edit").removeAttr("disabled")});n.fail(function(){})}function onInvestmentDetailsEdit(){if(!$(this).hasClass("disabled")){var t=$(this).attr("data-investmentid"),n=$.ajax({type:"GET",url:"/Investments/EditAjax",data:{id:t},dataType:"html"});n.done(function(n){$("#details .panel-body").html(n);var t=$("#InvestmentDetailsForm");t.removeData("validator");t.removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(t);t.data("validator").settings.ignore=".data-val-ignore, :hidden, :disabled";$("button.investment-details-edit").attr("disabled","disabled")});n.fail(function(){})}}function onSurveyRevertModalShowButtonClick(){var n=$(this).data("survey-id"),t=$("#SurveyRevertModalForm"),i=$("#SurveyId",t);i.val(n)}function onSurveyRevertModalCancelButtonClick(){var n=document.getElementById("SurveyRevertModalForm");n.reset()}function onSurveyRevertModalSubmitButtonClick(){ajaxSurveyRevertPost()}function onAjaxSurveyRevertCompleted(){window.location.reload()}function onAjaxSurveyRevertFailed(n,t,i){alert(i)}function ajaxSurveyRevertPost(){var t=$("#SurveyRevertModalForm"),i=$("#SurveyId",t),n=$.ajax({type:"POST",url:"/Surveys/RevertAjax",data:{surveyId:i.val()}});n.done(function(n,t){onAjaxSurveyRevertCompleted(n,t)});n.fail(function(n,t,i){onAjaxSurveyRevertFailed(n,t,i)})}function onSurveyRejectModalShowButtonClick(){var n=$(this).data("survey-id"),t=$("#SurveyRejectModalForm"),i=$("#SurveyId",t);i.val(n)}function onSurveyRejectModalCancelButtonClick(){var n=document.getElementById("SurveyRejectModalForm");n.reset()}function onSurveyRejectModalSubmitButtonClick(){ajaxSurveyRejectPost()}function onAjaxSurveyRejectCompleted(){window.location.reload()}function onAjaxSurveyRejectFailed(n,t,i){alert(i)}function ajaxSurveyRejectPost(){var t=$("#SurveyRejectModalForm"),i=$("#SurveyId",t),n=$.ajax({type:"POST",url:"/Surveys/RejectAjax",data:{surveyId:i.val()}});n.done(function(n,t){onAjaxSurveyRejectCompleted(n,t)});n.fail(function(n,t,i){onAjaxSurveyRejectFailed(n,t,i)})}function onSurveyApprovalModalShowButtonClick(){var n=$(this).data("survey-id"),t=$("#SurveyApprovalModalForm"),i=$("#SurveyId",t);i.val(n)}function onSurveyApprovalModalCancelButtonClick(){var n=document.getElementById("SurveyApprovalModalForm");n.reset()}function onSurveyApprovalModalSubmitButtonClick(){ajaxSurveyApprovePost()}function onAjaxSurveyApproveCompleted(){window.location.reload()}function onAjaxSurveyApproveFailed(n,t,i){alert(i)}function ajaxSurveyApprovePost(){var t=$("#SurveyApprovalModalForm"),i=$("#SurveyId",t),n=$.ajax({type:"POST",url:"/Surveys/ApproveAjax",data:{surveyId:i.val(),submitInvestment:!0}});n.done(function(n,t){onAjaxSurveyApproveCompleted(n,t)});n.fail(function(n,t,i){onAjaxSurveyApproveFailed(n,t,i)})}function onSurveySubmitModalShowButtonClick(){var n=$(this).data("survey-id"),t=$("#SurveySubmitModalForm"),i=$("#SurveyId",t);i.val(n)}function onSurveySubmitModalCancelButtonClick(){var n=document.getElementById("SurveySubmitModalForm");n.reset()}function onSurveySubmitModalSubmitButtonClick(){ajaxSurveySubmitPost()}function onAjaxSurveySubmitCompleted(){window.location.reload()}function onAjaxSurveySubmitFailed(n,t,i){alert(i)}function ajaxSurveySubmitPost(){var t=$("#SurveySubmitModalForm"),i=$("#SurveyId",t),n=$.ajax({type:"POST",url:"/Surveys/SubmitAjax",data:{surveyId:i.val(),submitInvestment:!0}});n.done(function(n,t){onAjaxSurveySubmitCompleted(n,t)});n.fail(function(n,t,i){onAjaxSurveySubmitFailed(n,t,i)})}function onSurveyCreateModalShowButtonClick(){onSurveyCreateSurveyTypeChange()}function onSurveyCreateModalCancelButtonClick(){var n=document.getElementById("SurveyCreateModalForm");n.reset()}function onSurveyCreateModalSubmitButtonClick(){var n=$("form#SurveyCreateModalForm");n.validate();n.valid()&&ajaxSurveyCreatePost()}function onSurveyCreateSurveyTypeChange(){var n=$("#SurveyCreateModalForm"),f=$("#SurveyType",n).val(),t=$("#SurveyCreateModalFormRSEType",n),i=$("#RSETypeEN",n),r=$("#RSETypeHW",n),u=$("#RSETypeCH",n);i.hide();u.hide();r.hide();switch(f){case"0":u.show();t.show();break;case"1":r.show();t.show();break;case"2":i.show();t.show();break;default:t.hide()}}function onAjaxSurveyCreateCompleted(){var t=$("#SurveyCreateModal"),n;t.modal("hide");n=document.getElementById("SurveyCreateModalForm");n.reset();window.location.reload()}function onAjaxSurveyCreateFailed(n,t,i){var u=$("#SurveyCreateModal"),r;u.modal("hide");r=document.getElementById("SurveyCreateModalForm");r.reset();alert(i)}function ajaxSurveyCreatePost(){var t=$("#SurveyCreateModalForm"),n=$.ajax({type:"POST",url:"/Surveys/CreateAjax",data:t.serialize()});n.done(function(n,t){onAjaxSurveyCreateCompleted(n,t)});n.fail(function(n,t,i){onAjaxSurveyCreateFailed(n,t,i)})}function onSurveyCancelModalShowButtonClick(){var n=$(this).attr("data-survey-id"),t=$("#SurveyCancelModalForm");$("#SurveyId",t).val(n)}function onSurveyCancelModalCancelButtonClick(){var n=document.getElementById("SurveyCancelModalForm");n.reset()}function onSurveyCancelModalSubmitButtonClick(){var n=$("form#SurveyCancelModalForm");n.validate();n.valid()&&ajaxSurveyCancelPost()}function onSurveyCancelNewSurveyChange(n){var t=$("form#SurveyCancelModalForm"),i=$("#ReplaceWithType",t);n.data?(i.attr("data-val","true"),i.attr("data-val-required","Pole jest obowiązkowe")):(i.removeAttr("data-val"),i.removeAttr("data-val-required"));t.removeData("validator");t.removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(t);t.data("validator").settings.ignore=".data-val-ignore, :hidden, :disabled"}function onSurveyCancelReplaceWithChange(){var n=$("#SurveyCancelModalForm"),f=$(this).val(),t=$("#SurveyCancelModalFormRSEType",n),i=$("#ReplaceWithRSEEN",n),r=$("#ReplaceWithRSEHW",n),u=$("#ReplaceWithRSECH",n);i.hide();u.hide();r.hide();switch(f){case"0":u.show();t.show();break;case"1":r.show();t.show();break;case"2":i.show();t.show();break;default:t.hide()}}function onAjaxSurveyCancelCompleted(){var t=$("#SurveyCancelModal"),n;t.modal("hide");n=document.getElementById("SurveyCancelModalForm");n.reset();window.location.reload()}function onAjaxSurveyCancelFailed(n,t,i){var u=$("#SurveyCancelModal"),r;u.modal("hide");r=document.getElementById("SurveyCancelModalForm");r.reset();alert(i)}function ajaxSurveyCancelPost(){var t=$("#SurveyCancelModalForm"),n=$.ajax({type:"POST",url:"/Surveys/CancelAjax",data:t.serialize()});n.done(function(n,t){onAjaxSurveyCancelCompleted(n,t)});n.fail(function(n,t,i){onAjaxSurveyCancelFailed(n,t,i)})}function optionBtnTrue(){var i=$(this).attr("data-linked-checkbox"),n,t;i&&$('input[name="'+i+'"]').val("True");n=$(this).attr("data-linked-element-show");t=$(this).attr("data-linked-element-hide");n&&$(n).collapse("show");t&&$(t).collapse("hide")}function optionBtnFalse(){var i=$(this).attr("data-linked-checkbox"),n,t;i&&$('input[name="'+i+'"]').val("False");n=$(this).attr("data-linked-element-show");t=$(this).attr("data-linked-element-hide");n&&$(n).collapse("show");t&&$(t).collapse("hide")}class WgRSEEnum{constructor(){this.surveyType=["CO","CWU","EE"];this.rseType=[["","Pompa Ciepła Grunt.","Kocioł na Pellet","Pompa Ciepła Powietrzna"],["","","","Solary","Pompa Ciepła"],["","","","","","Panele Fotowolt."]]}getText(n,t,i){return t===undefined?this.surveyType[n]:i?this.rseType[n][t]:this.rseType[n][t]+" ("+this.surveyType[n]+")"}getId(n,t){for(var u,r=-1,f=-1,i=0;i<this.surveyType.length;i++)this.surveyType[i]===n&&(r=i);if(t===undefined)return r;if(r>=0)for(u=0;u<this.rseType[r].length;u++)this.surveyType[r][i]===n&&(f=i);return f}}class WgLocEnum{constructor(){this._array=["Dach","Grunt","Elewacja"]}getText(n){return this._array[n]}getValue(n){for(var t=0;t<this._array.length;t++)if(this._array[t]===n)return t}}class WgBdgEnum{constructor(){this._array=["Gospodarczy","Mieszkalny"]}getText(n){return this._array[n]}getValue(n){for(var t=0;t<this._array.length;t++)if(this._array[t]===n)return t}}class WgEnuSrvCancelStatus{constructor(){this._array=["Przed inspekcją","Po inspekcji","Instalacja niemożliwa","Brak kontaktu z właścicielem","Błąd - niezamawiane źródło"]}getText(n){return this._array[n]}getValue(n){for(var t=0;t<this._array.length;t++)if(this._array[t]===n)return t}}class WgEnuSrvStatus{constructor(){this._array=["Nowa","W trakcie realizacji","W trakcie weryfikacji","Do poprawy","Zatwierdzona","Anulowana"]}getText(n){return this._array[n]}getValue(n){for(var t=0;t<this._array.length;t++)if(this._array[t]===n)return t}}var WgEnums={rse:new WgRSEEnum,localization:new WgLocEnum,building:new WgBdgEnum,status:new WgEnuSrvStatus,cancel:new WgEnuSrvCancelStatus};$(document).ready(function(){var n=$("#SurveyListTable").data("investmentid"),t=$("#SurveyListTable").data("admin");InitializeSurveyListTab(n)});$("body").on("click",".btn[data-target]",function(n){$(this).hasClass("disabled")&&n.stopPropagation()});$("body").on("click",'button[data-target="#SrvMoveModal"]',onSurveyMoveModalShowButtonClick);$("body").on("click","button.srvmovemodal-btn-cancel",onSurveyMoveModalCancelButtonClick);$("body").on("click","button.srvmovemodal-btn-submit",onSurveyMoveModalSubmitButtonClick);$("button.investment-details-edit").on("click",onInvestmentDetailsEdit);$("body").on("click","form#InvestmentDetailsForm button.submit",onInvestmentDetailsSave);$("body").on("click","form#InvestmentDetailsForm button.cancel",onInvestmentDetailsCancel);$("body").on("click",'button[data-target="#SrvRevertModal"]',onSurveyRevertModalShowButtonClick);$("body").on("click","button.srvrevertmodal-btn-cancel",onSurveyRevertModalCancelButtonClick);$("body").on("click","button.srvrevertmodal-btn-submit",onSurveyRevertModalSubmitButtonClick);$("body").on("click",'button[data-target="#SrvRejectModal"]',onSurveyRejectModalShowButtonClick);$("body").on("click","button.srvrejectmodal-btn-cancel",onSurveyRejectModalCancelButtonClick);$("body").on("click","button.srvrejectmodal-btn-submit",onSurveyRejectModalSubmitButtonClick);$("body").on("click",'button[data-target="#SrvApprovalModal"]',onSurveyApprovalModalShowButtonClick);$("body").on("click","button.srvapprovalmodal-btn-cancel",onSurveyApprovalModalCancelButtonClick);$("body").on("click","button.srvapprovalmodal-btn-submit",onSurveyApprovalModalSubmitButtonClick);$("body").on("click",'button[data-target="#SrvSubmitModal"]',onSurveySubmitModalShowButtonClick);$("body").on("click","button.srvsubmitmodal-btn-cancel",onSurveySubmitModalCancelButtonClick);$("body").on("click","button.srvsubmitmodal-btn-submit",onSurveySubmitModalSubmitButtonClick);$("body").on("click",'button[data-target="#SrvCreateModal"]',onSurveyCreateModalShowButtonClick);$("body").on("click","button.srvcreatemodal-btn-cancel",onSurveyCreateModalCancelButtonClick);$("body").on("click","button.srvcreatemodal-btn-submit",onSurveyCreateModalSubmitButtonClick);$("body").on("change","#SurveyType",onSurveyCreateSurveyTypeChange);$("body").on("click",'button[data-target="#SrvCancelModal"]',onSurveyCancelModalShowButtonClick);$("body").on("click","button.srvcancelmodal-btn-cancel",onSurveyCancelModalCancelButtonClick);$("body").on("click","button.srvcancelmodal-btn-submit",onSurveyCancelModalSubmitButtonClick);$("body").on("change",".optionbutton-true",!0,onSurveyCancelNewSurveyChange);$("body").on("change",".optionbutton-false",!1,onSurveyCancelNewSurveyChange);$("body").on("change","#ReplaceWithType",onSurveyCancelReplaceWithChange);$("body").on("change",".optionbutton-true",optionBtnTrue);$("body").on("change",".optionbutton-false",optionBtnFalse);