function onReportDownload(n){var i=n.data().reportName,t=$.ajax({type:"GET",url:"InspectionSummaryList",data:{singleDocuments:!0,reportName:i},dataType:"json"});t.done(function(n){n.data.forEach(function(n){window.open(n.url,"_blank")})});t.fail(function(n,t,i){WgTools.alert(i,!1,"E")})}function onReportCreate(){var n=$.ajax({type:"GET",url:"InspectionSummaryCreateAjax",dataType:"html"});n.done(function(n){$("#ReportDeleteModal").after(n);var i=$("#ReportCreateModal"),t=$("form",i);t.removeData("validator");t.removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(t);t.data("validator").settings.ignore=".data-val-ignore, :hidden, :disabled";i.modal("show");$("body").on("click","button.report-create-cancel",onReportCreateCancel);$("body").on("click","button.report-create-submit",onReportCreateSubmit);$("body").on("change","select.data-project",onProjectChange)});n.fail(function(n,t,i){WgTools.alert(i,!1,"E")})}function onReportCreateCancel(){DestroyModal("#ReportCreateModal")}function onReportCreateSubmit(){var n=$("form",$("#ReportCreateModal")),r=$(":input:not([type=hidden],[hidden],[readonly])",n),t=$("button.report-create-submit"),f=t.text(),u,i;n.validate({lang:"pl"});n.valid()&&(u=n.serialize(),r.each(function(){$(this).attr("disabled","disabled")}),t.text("Trwa generowanie..."),i=$.ajax({type:n.attr("data-ajax-method")||"POST",url:n.attr("action"),data:u,timeout:6e5}),i.fail(function(n){WgTools.alert(n,!1,"E");r.each(function(){$(this).removeAttr("disabled")});t.text(f)}),i.done(function(){DestroyModal("#ReportCreateModal");$("#InspectionSummaryTable").DataTable().ajax.reload();WgTools.alert("Pomyślnie wygenerowano nowy raport",!0,"S")}))}function onProjectChange(){var n=$(this).val(),i=$(this).attr("data-project"),t;n!==i&&($(this).attr("data-project",n),t=$.ajax({type:"GET",url:"/Contracts/GetContractsAjax",data:{projectId:n},dataType:"json",contentType:"application/json"}),t.done(function(n){for(var t=document.getElementById("ContractId"),i;t.options.length;)t.remove(0);i=new Option("","");t.options.add(i);$.each(n,function(n,i){var r=new Option(i.text,i.value);t.options.add(r)})}),t.fail(function(n,t,i){WgTools.alert(i,!0,"E")}))}function DestroyModal(n){var t=$(n);t.one("hidden.bs.modal",function(){t.remove()});t.modal("hide")}$(document).ready(function(){var n=[],t=$("#InspectionSummaryTable").DataTable({ajax:{url:"InspectionSummaryList",dataSrc:"data",rowId:"key",data:{singleDocuments:!1,reportName:""}},columns:[{data:"reportName",name:"Raport",type:"html",render:function(t){return(n.length>0&&n[n.length-1]!==t||n.length===0)&&n.push(t),'<span class="glyphicon glyphicon-folder-close"><\/span> '+t}},{data:"count",name:"Liczba dokumentów"},{data:null,name:"Akcje",orderable:!1,searchable:!1,type:"html",render:function(){return content='<div class="pull-right">',content+='<button class="btn btn-default btn-sm report-delete" type="button" title="Usuń"><span class="glyphicon glyphicon-trash"><\/span><\/button>',content+='<button class="btn btn-default btn-sm report-download" type="button" title="Pobierz"><span class="glyphicon glyphicon-download-alt"><\/span><\/button>',content+="<\/div>"}}],stateSave:!0,language:{url:"/js/datatables-language-pl.json"},lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"Wszystkie"]],order:[[0,"asc"]],processing:!0,dom:"<'row'<'col-sm-6'B><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-3'l><'col-sm-3'i><'col-sm-6'p>>",buttons:[{extend:"copyHtml5",text:'<span class="glyphicon glyphicon-copy"><\/span>',className:"btn-sm text-primary"},{extend:"csvHtml5",text:'<span class="glyphicon glyphicon-download-alt" title="Export do CSV"><\/span>',className:"btn-sm text-primary"},{text:'<span class="text-primary glyphicon glyphicon-refresh" title="Odśwież zawartość"><\/span>',className:"btn-sm",action:function(n,t){t.ajax.reload();t.columns.adjust().draw()}},{text:'<span class="glyphicon glyphicon-plus" title="Utwórz nowy raport"><\/span>',className:"btn-sm btn-primary",action:function(n,t){$(this).attr("disabled","disabled");onReportCreate(t);$(this).removeAttr("disabled")}}],select:!1,responsive:!0,fixedHeader:{headerOffset:$("#NavBarMain").outerHeight()},drawCallback:function(){$("div#InspectionSummaryTable_processing").addClass("wg-loader");var n=$("div#InspectionSummaryTable_filter");$("*",n).addClass("small");n=$("div#InspectionSummaryTable_length");$("label",n).addClass("small");$("select",n).addClass("small");n=$("div#InspectionSummaryTable_info");n.addClass("small");$("*",n).addClass("small");n=$("div#InspectionSummaryTable_paginate");$("ul > li > a",n).addClass("small").attr("style","padding: 5px 10px;");$(".parentrow").closest("tr").each(function(){var n=t.row(this);childrows=$(this).closest("tr").nextUntil(".parentrow");n.child(childrows).hide()})},createdRow:function(n,t){t.name===""&&t.url===""&&$(n).addClass("parentrow")}})});$("body").on("click","button.report-delete",function(){$(this).attr("disabled","disabled");onReportDelete($("#InspectionSummaryTable").DataTable().row($(this).parents("tr")));$(this).removeAttr("disabled")});$("body").on("click","button.report-download",function(){$(this).attr("disabled","disabled");onReportDownload($("#InspectionSummaryTable").DataTable().row($(this).parents("tr")));$(this).removeAttr("disabled")});