function onNeoenergetykaFileChange(n){var i,t,u,r;if(i=$(this)[0].files[0],i===undefined){WgTools.alert("Proszę wskazać plik do importu!",!0,"E");n.data.dt.table().buttons().enable();t=$("div#InvestmentListTable_processing");t.hide();return}if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(i.type)){$(this).val("");n.data.dt.table().buttons().enable();t=$("div#InvestmentListTable_processing");t.hide();WgTools.alert("Niedozwolony format pliku!",!0,"E");return}u=new FormData($("form#NeoenergetykaForm")[0]);$(this).val("");r=$.ajax({type:"POST",url:"/Contracts/UploadNeoenergetykaResults",contentType:!1,processData:!1,data:u,beforeSend:function(){}});r.done(function(){WgTools.alert("Pomyślnie wczytano dane",!0,"S");n.data.dt.table().buttons().enable();n.data.dt.ajax.reload();n.data.dt.rows().cells().invalidate().render()});r.fail(function(t){n.data.dt.table().buttons().enable();var i=$("div#InvestmentListTable_processing");i.hide();json=t.responseJSON;json.neoenergetyka!==null?WgTools.alert(json.neoenergetyka,!1,"E"):WgTools.alert(json,!1,"E")})}$(document).ready(function(){var n="/api/v1/Investments/Neo?contractId="+$("#ContractId").val(),t=$("#InvestmentListTable").DataTable({ajax:{url:n,dataSrc:"",rowId:"investmentId"},columns:[{data:"address",name:"address",title:"Adres"},{data:"plotNumber",name:"plotNumber",title:"Nr działki"},{data:"status",name:"status",title:"Status"},{className:"none",data:"inspectionStatus",name:"inspectionStatus",title:"Status inspekcji"},{data:"calculate",name:"calculate",title:"Do weryfikacji"},{className:"none",data:"surveys",name:"surveys",title:"Źródła",render:function(n,t){var f,i,r,e,u;if(t!=="display")return n;if(f=n.length,i="",f>0)for(i='<div class="row">',i+='<div class="col-sm-3"><span class="control-label">Typ OZE<\/span><\/div>',i+='<div class="col-sm-4">Status<\/div>',i+='<div class="col-sm-3">Moc<\/div>',i+='<div class="col-sm-2">Policzone<\/div>',i+="<\/div>",r=0;r<f;r++)e=n[r].finalPower,i+='<div class="row">',i+='<div class="col-sm-3">'+n[r].rseType+"<\/div>",u=n[r].status,u=u.length>10?u.substring(0,9)+"...":u,i+='<div class="col-sm-4" title="'+n[r].status+'">'+u+"<\/div>",i+='<div class="col-sm-3">'+e.toFixed(2)+" kW <\/div>",i+='<div class="col-sm-2">'+(n[r].isCompleted===!0?"Tak":"Nie")+"<\/div>",i+="<\/div>";return i}},{data:null,className:"all",name:"actions",title:"Akcje",orderable:!1,searchable:!1,type:"html",width:"100px",autoWidth:!1,visible:!0,render:function(n,t,i){var u=i.investmentId,r="";return r='<div class="pull-right">',r+='<a class="btn btn-sm btn-default" href="/Investment/Details/'+u+'">',r+='<span class="glyphicon glyphicon-eye-open"><\/span>',r+="<\/a>",r+"<\/div>"}}],stateSave:!1,pagingType:"full",language:WgLanguage,lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"Wszystkie"]],order:[[0,"asc"]],processing:!0,dom:"<'row wg-dt-padding'<'col-sm-6'B><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row wg-dt-padding'<'col-sm-4'l><'col-sm-4'i><'col-sm-4'p>>",buttons:[{extend:"colvis",text:'<span class="glyphicon glyphicon-th-list" title="Pokaż / Ukryj kolumny"><\/span>',className:"btn text-primary"},{text:'<span class="text-primary glyphicon glyphicon-refresh"><\/span>',titleAttr:"Odśwież zawartość",className:"btn",action:function(n,t){t.ajax.reload();t.rows().cells().invalidate().render()}},{text:'<span class="text-primary glyphicon glyphicon-download"><\/span> Pobierz',titleAttr:"Pobierz do weryfikacji kolejne 50 inwestycji",className:"btn",action:function(n,t){var i,u,r;t.table().buttons().disable();i=$("div#InvestmentListTable_processing");i.show();u="/api/v1/Survey/Neo?contractId="+$("#ContractId").val();r=new $.get(u);r.fail(function(n){i.hide();t.table().buttons().enable();WgTools.alert(n.responseJSON.error,!1,"E")});r.done(function(n){var r=WgTools.createLink(n.ResponseJSON.url);document.body.appendChild(r);r.click();i.hide();t.table().buttons().enable();WgTools.alert("Pomyślnie wygenerowano plik",!0,"S")})}},{text:'<span class="text-primary glyphicon glyphicon-upload"><\/span> Zapisz',titleAttr:"Zapisz wyniki (dobory)",className:"btn",action:function(n,t){var r,i;t.table().buttons().disable();r=$("div#InvestmentListTable_processing");r.show();i=$("input#Neoenergetyka",$("form#NeoenergetykaForm"));i.one("change",{dt:t},onNeoenergetykaFileChange);i.focus().trigger("click")}},{text:'<span class="text-primary glyphicon glyphicon-filter"><\/span>Filtruj',titleAttr:"Pokaż tylko do wykonania",className:"btn",action:function(n,t,i){var r=t.table().column("calculate:name").search();r!=""?(t.table().column("calculate:name").search("").draw(),i.html(i.html().replace("Pokaż wszystko","Filtruj"))):(t.table().column("calculate:name").search("Tak").draw(),i.html(i.html().replace("Filtruj","Pokaż wszystko")))}},],select:!1,colReorder:{fixedColumnsRight:1},responsive:{details:{renderer:function(n,t,i){var r=$.map(i,function(n){return n.hidden?'<div class="row" data-dt-row="'+n.rowIndex+'" data-dt-column="'+n.columnIndex+'"><div class="col-sm-2">'+n.title+':<\/div> <div class="col-sm-10">'+n.data+"<\/div><\/div>":""}).join("");return r?r:!1}}},fixedHeader:{headerOffset:$("#NavBarMain").outerHeight()}})});